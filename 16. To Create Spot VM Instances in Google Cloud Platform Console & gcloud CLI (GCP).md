![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F5k66dbeoewdvdauk6r83.png)

### **Tạo Spot VM Instances trên Google Cloud Platform bằng Console và gcloud CLI (GCP)**

---

### Tổng quan

Chi phí vận hành trên nền tảng đám mây có thể tăng nhanh, đặc biệt với các workload quy mô lớn. Trong trường hợp workload **có khả năng chịu lỗi và chấp nhận gián đoạn**, **Spot VMs** trong **Google Compute Engine (GCE)** là một lựa chọn hiệu quả, giúp **tiết kiệm từ 60% đến 91% chi phí** so với VM tiêu chuẩn.

Tài liệu này trình bày quy trình tạo **Spot VM Instances** theo từng bước:

* Sử dụng **Google Cloud Console**
* Sử dụng **gcloud CLI**

Đồng thời triển khai một **Nginx Web Server** thông qua **startup script** để kiểm thử VM.

---

### Bước 01: Giới thiệu về Spot VMs

**Spot VMs** là các máy ảo tạm thời được cung cấp với mức chi phí thấp.

Đặc điểm:

* Có thể bị **dừng hoặc xóa bất kỳ lúc nào** khi Google Cloud cần tài nguyên
* Trước khi bị thu hồi, VM nhận được **thông báo trước 30 giây**
* Phù hợp nhất cho:

  * CI/CD pipelines
  * Big Data và Analytics
  * Batch jobs
  * Node pools trong Google Kubernetes Engine (GKE)

---

### Bước 02: Tạo Spot VM Instance bằng Google Cloud Console

Truy cập:

**Navigation Menu → Compute Engine → VM Instances → Create Instance**

Cấu hình các thông tin sau:

**Thông tin cơ bản**

* **Name**: `demo6-vm-spot`
* **Labels**: `environment: dev`
* **Region**: `us-central1`
* **Zone**: `us-central1-a`

**Machine Configuration**

* **Series**: E2
* **Machine Type**: `e2-micro`
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F0boz8mois7v74bm2cyqc.png)

**Operating System and Storage**

* Giữ nguyên cấu hình mặc định

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fvshafje0vzydj32yifvg.png)


**Other Settings**

* **Display Device**: Bật
* **Confidential VM**: Tắt
* **Container**: Tắt
* **Boot Disk**: Mặc định
* **Service Account**: Compute Engine default service account
* **Access Scopes**: Allow default access
* **Firewall**: Bật **Allow HTTP traffic**

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3u8hr29csca1aluyz3nx.png)

**Automation – Startup Script**
Sao chép nội dung từ file `webserver-install.sh`:

```bash
#!/bin/bash
sudo apt install -y telnet
sudo apt install -y nginx
sudo systemctl enable nginx
sudo chmod -R 755 /var/www/html
HOSTNAME=$(hostname)
sudo echo "<!DOCTYPE html> <html> <body style='background-color:rgb(250, 210, 210);'> <h1>Welcome to Latchu@DevOps - WebVM App1 </h1> <p><strong>VM Hostname:</strong> $HOSTNAME</p> <p><strong>VM IP Address:</strong> $(hostname -I)</p> <p><strong>Application Version:</strong> V1</p> <p>Google Cloud Platform - Demos</p> </body></html>" | sudo tee /var/www/html/index.html
```

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fmb5qqzuasyi5pl31229n.png)




**Availability Policies**

* **VM Provisioning Model**: `SPOT`
* **On VM termination**:

  * `STOP` (mặc định) hoặc
  * `DELETE`

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fjgpzh8du3936uorfv0k0.png)

Nhấn **Create** để khởi tạo VM.

---

### Bước 03: Xác minh VM

Truy cập:

**VM Instances → demo6-vm-spot → Details**

* Kiểm tra **Availability Policies**
* Xác nhận **Provisioning Model = SPOT**
* Lưu ý cảnh báo về khả năng VM bị thu hồi bất kỳ lúc nào

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F2826xl1b37ynrf98hb2c.png)
---

### Bước 04: Truy cập ứng dụng

Sau khi VM khởi động thành công, mở trình duyệt và truy cập:

```
http://<EXTERNAL-IP-OF-VM>
```

Trang chào mừng Nginx tùy chỉnh sẽ được hiển thị.

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fahoifarcw3cwpsmkz5ob.png)
---

### Bước 05: Xóa VM

Xóa VM bằng Console hoặc sử dụng gcloud CLI:

```bash
gcloud compute instances delete demo6-vm-spot --zone us-central1-a
```

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F2wefso98p39prhw6n14r.png)
---

### Bước 06: Tạo Spot VM bằng gcloud CLI

#### 1. Thiết lập Project

```bash
gcloud config set project PROJECT_ID
gcloud config set project gcpdemos
```

#### 2. Tạo Spot VM Instance

```bash
gcloud compute instances create demo6-vm-spot-gcloud \
  --provisioning-model=SPOT \
  --instance-termination-action=STOP \
  --zone=us-central1-a \
  --machine-type=e2-micro \
  --network-interface=subnet=default \
  --tags=http-server \
  --metadata-from-file=startup-script=webserver-install.sh
```

Trong đó:

* `--provisioning-model=SPOT`: tạo Spot VM
* `--instance-termination-action=STOP`: VM dừng khi bị thu hồi (có thể cấu hình `DELETE`)

#### 3. Truy cập ứng dụng

```
http://<EXTERNAL-IP-OF-VM>
```

#### 4. Xóa VM

```bash
gcloud compute instances delete demo6-vm-spot-gcloud --zone us-central1-a
```

---

### Tổng kết

**Spot VMs** là giải pháp tối ưu chi phí hiệu quả trong GCP, đặc biệt phù hợp với các workload:

* Stateless
* Chịu lỗi (fault-tolerant)
* Có thể bị gián đoạn

Việc kết hợp Spot VMs với **tự động hóa, autoscaling và container hóa (GKE)** cho phép đạt được mức tiết kiệm chi phí đáng kể mà vẫn duy trì hiệu năng hệ thống.
