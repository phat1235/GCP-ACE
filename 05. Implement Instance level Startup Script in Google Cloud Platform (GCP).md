![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fxb9utmxtjdc1dhn3ftuz.png)

## **Phần 5: Triển khai Startup Script ở cấp độ Instance trong Google Cloud Platform (GCP)**

---

Startup Script trong Google Cloud cho phép tự động thực thi các lệnh ngay khi máy ảo **Compute Engine VM** khởi động. Cơ chế này đặc biệt hữu ích trong việc cài đặt gói phần mềm, cấu hình web server và chuẩn hóa môi trường vận hành mà không cần thao tác thủ công.

Tài liệu này trình bày quy trình tạo một VM trong Google Cloud Platform và triển khai **Startup Script ở cấp độ Instance** để cài đặt **Nginx** và cung cấp một trang HTML tùy chỉnh.

---

## 1. Bước 1: Kích hoạt Compute Engine API

Trước khi tạo VM, cần đảm bảo rằng **Google Compute Engine API** đã được kích hoạt cho dự án Google Cloud hiện tại. Đây là điều kiện bắt buộc để sử dụng dịch vụ Compute Engine.

---

## 2. Bước 2: Tạo VM Instance


Thực hiện theo đường dẫn:

**Google Cloud Console → Compute Engine → VM Instances → Create Instance**

Cấu hình VM với các thông số sau:

### 2.1. Thông tin cơ bản


![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3u33cpqevnokafq3ihli.png)



* **Name:** `demo2-vm-startupscript`
* **Labels:**

  * `environment: dev`
* **Region:** `us-central1`
* **Zone:** `us-central1-a`

### 2.2. Cấu hình máy (Machine Configuration)

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fc4f515x52z3izz4oten4.png)

* **Series:** E2
* **Machine Type:** `e2-micro` (thuộc Free Tier)

### 2.3. Hệ điều hành và lưu trữ
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fh852wc5kcghcsjn2r51c.png)

* **Availability Policies:** Standard provisioning
* **Display Device:** Không chọn
* **Confidential VM Service:** Không chọn
* **Container:** Không chọn
* **Boot Disk:** Giữ cấu hình mặc định

  * Khuyến nghị sử dụng Debian hoặc Ubuntu

### 2.4. Identity & API Access

* **Service Account:** Compute Engine default service account
* **Access Scopes:** Allow default access

### 2.5. Firewall

* ✅ Cho phép lưu lượng HTTP (Allow HTTP traffic)

---

## 3. Bước 3: Cấu hình Startup Script

Mở rộng:

**Advanced Options → Management → Automation → Startup Script**

Dán nội dung Startup Script sau:

```bash
#!/bin/bash
sudo apt install -y telnet
sudo apt install -y nginx
sudo systemctl enable nginx
sudo chmod -R 755 /var/www/html
HOSTNAME=$(hostname)
sudo echo "<!DOCTYPE html> <html> <body style='background-color:rgb(250, 210, 210);'> <h1>Welcome to Latchu@DevOps - WebVM App1 </h1> <p><strong>VM Hostname:</strong> $HOSTNAME</p> <p><strong>VM IP Address:</strong> $(hostname -I)</p> <p><strong>Application Version:</strong> V1</p> <p>Google Cloud Platform - Demos</p> </body></html>" | sudo tee /var/www/html/index.html
```

Startup Script này thực hiện các chức năng sau:

* Cài đặt gói `telnet`.
* Cài đặt và kích hoạt dịch vụ **Nginx**.
* Phân quyền truy cập thư mục web.
* Tạo trang HTML hiển thị thông tin hostname, địa chỉ IP và phiên bản ứng dụng.

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fazq45r8izi2ajcmlhr5s.png)

---

## 4. Bước 4: Cấu hình bổ sung

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ffo23k5l2kpm7ory3l05y.png)
* **Description:** `demo2-vm-startupscript`
* **Deletion Protection:** ✅ Bật (Enable)
* **Reservations:** Giữ mặc định
* **Metadata:** Để trống
* **Data Encryption:** Giữ cấu hình mặc định

Sau khi hoàn tất cấu hình, chọn **Create** để khởi tạo VM.

---

## 5. Bước 5: Truy cập trang web

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fovdyiqbndqa1chyx9axn.png)

Sau khi VM ở trạng thái **RUNNING**, dịch vụ Nginx đã được khởi chạy tự động thông qua Startup Script. Trang web có thể được truy cập trực tiếp từ trình duyệt thông qua **External IP** của VM.

---

## 6. Bước 6: Xóa VM Instance
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fgb2wcs7mipd2m53p5dk7.png)

Do **Deletion Protection** đã được bật, tùy chọn **Delete** sẽ bị vô hiệu hóa.


![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F21rzbh06qi1iju5yifp4.png)
Để xóa VM, thực hiện:

* Vào **VM Instances → chọn VM → Edit**
* Tại mục **Deletion Protection**, bỏ chọn **Enable deletion protection**
* Lưu thay đổi

Sau đó, VM có thể được xóa an toàn khi không còn nhu cầu sử dụng.

---

**Kết luận:**
Việc triển khai Startup Script ở cấp độ Instance cho phép tự động hóa toàn bộ quá trình cấu hình ban đầu của VM, đảm bảo tính nhất quán, giảm thiểu sai sót thủ công và nâng cao hiệu quả triển khai hạ tầng. Đây là kỹ năng cốt lõi đối với **Google Cloud Associate Cloud Engineer** trong thực tiễn vận hành hệ thống.
