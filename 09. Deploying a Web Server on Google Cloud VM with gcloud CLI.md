![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F8rxw9dtcm2cp405st79u.png)
## **Triển khai Web Server trên máy ảo Google Cloud bằng gcloud CLI (GCP)**
**Định hướng:** Google Cloud Associate Cloud Engineer

---

## 1. Tổng quan

Google Cloud cung cấp nhiều phương thức để quản lý hạ tầng, bao gồm:

* Giao diện đồ họa **Google Cloud Console**
* **Cloud Shell**
* **gcloud CLI**

Trong nội dung này, sử dụng **gcloud CLI trong Cloud Shell** để:

* Tạo một máy ảo (Virtual Machine – VM)
* Cài đặt web server Nginx thông qua **startup script**
* Thực hiện các thao tác vòng đời tài nguyên: khởi động, dừng, cập nhật và xóa VM

Cách tiếp cận này phù hợp với chuẩn **tự động hóa và quản trị hạ tầng** của Associate Cloud Engineer.

---

## 2. Bước 1: Khởi chạy Cloud Shell

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F0gzhx33w9jcc7sbq58qe.png)
* Mở **Google Cloud Console**
* Nhấn vào biểu tượng **Cloud Shell** (góc trên bên phải)
* Cấp quyền khi được yêu cầu

Sau khi hoàn tất, người dùng có một terminal kết nối trực tiếp với môi trường GCP, trong đó **gcloud CLI đã được cài đặt sẵn và cấu hình mặc định**.

---

## 3. Bước 2: Tạo và tải Startup Script

Tạo file `webserver-install.sh` với nội dung sau:

```bash
#!/bin/bash
sudo apt update -y
sudo apt install -y telnet
sudo apt install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx
sudo chmod -R 755 /var/www/html

HOSTNAME=$(hostname)

sudo echo "<!DOCTYPE html>
<html>
  <body style='background-color:rgb(250, 210, 210);'>
    <h1>Welcome to Latchu@DevOps - WebVM App1</h1>
    <p><strong>VM Hostname:</strong> $HOSTNAME</p>
    <p><strong>VM IP Address:</strong> $(hostname -I)</p>
    <p><strong>Application Version:</strong> V1</p>
    <p>Google Cloud Platform - Demos</p>
  </body>
</html>" | sudo tee /var/www/html/index.html
```

Cấp quyền thực thi cho script:

```bash
ls -lh
chmod +x webserver-install.sh
```

**Startup script** sẽ tự động được thực thi khi VM khởi tạo lần đầu, dùng để cài đặt Nginx và triển khai một trang web mẫu hiển thị hostname, địa chỉ IP và phiên bản ứng dụng.

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F3odmun7bsvdj9snclfjs.png)
---

## 4. Bước 3: Cấu hình Project cho gcloud

Thiết lập project đang hoạt động:

```bash
gcloud config set project PROJECT_ID
```

Ví dụ:

```bash
gcloud config set project gcp-zero-to-hero-468909
```

Việc cấu hình project là bắt buộc để gcloud xác định phạm vi tài nguyên được quản lý.

---

## 5. Bước 4: Tạo VM và gắn Startup Script

Thực hiện lệnh tạo máy ảo:

```bash
gcloud compute instances create demo3-vm-gcloud \
  --zone=us-central1-a \
  --machine-type=e2-micro \
  --network-interface=subnet=default \
  --tags=http-server \
  --metadata-from-file=startup-script=webserver-install.sh
```

Giải thích cấu hình chính:

* `zone`: vùng triển khai tài nguyên
* `machine-type`: cấu hình phần cứng VM
* `tags=http-server`: phục vụ việc áp dụng firewall rule cho HTTP
* `startup-script`: script tự động chạy khi VM khởi tạo

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fyfirrlot7k5ysktpttcb.png)
---

## 6. Bước 5: Quản lý vòng đời VM

### Liệt kê các VM trong project

```bash
gcloud compute instances list
```

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fkbqbvcmfus9q7mtdrtun.png)

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F331440vklvpui6lc3pkf.png)

### Dừng VM

```bash
gcloud compute instances stop demo3-vm-gcloud --zone=us-central1-a
```

### Khởi động lại VM

```bash
gcloud compute instances start demo3-vm-gcloud --zone=us-central1-a
```

---

## 7. Bước 6: Cấu hình bảo vệ xóa VM (Deletion Protection)

### Bật chế độ bảo vệ xóa

```bash
gcloud compute instances update demo3-vm-gcloud \
    --zone=us-central1-a \
    --deletion-protection
```

### Thử xóa VM (thao tác sẽ thất bại)

```bash
gcloud compute instances delete demo3-vm-gcloud --zone=us-central1-a
```

Lỗi trả về:

```text
ERROR: (gcloud.compute.instances.delete) Could not fetch resource:
 - Invalid resource usage: 'Resource cannot be deleted if it's protected against deletion.'
```

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Frggonke6uut1n1q05o22.png)

### Tắt chế độ bảo vệ xóa

```bash
gcloud compute instances update demo3-vm-gcloud \
    --zone=us-central1-a \
    --no-deletion-protection
```

### Xóa VM

```bash
gcloud compute instances delete demo3-vm-gcloud --zone=us-central1-a
```
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ffzvatiz05gp3hc9qa7yc.png)
---

## 8. Kết luận

Nội dung trên đã trình bày quy trình hoàn chỉnh để:

* Sử dụng **Cloud Shell** cùng **gcloud CLI**
* Triển khai VM với **startup script**
* Quản lý vòng đời máy ảo: tạo, liệt kê, dừng, khởi động
* Áp dụng và gỡ bỏ **deletion protection** nhằm bảo vệ tài nguyên

Đây là phương pháp triển khai hạ tầng **chuẩn hóa, có thể lặp lại và tự động hóa**, phù hợp với yêu cầu thực tiễn và chuẩn năng lực của **Google Cloud Associate Cloud Engineer**.
