![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F75oey2sys34bgzgv0piz.png)

**Phần 4: Giải thích về Startup Script của máy ảo trong Google Cloud Platform (GCP)**

---

Trong quá trình làm việc với **Google Compute Engine (GCE)**, nhu cầu tự động hóa các tác vụ như cài đặt phần mềm, cấu hình hệ thống, thiết lập tường lửa, hoặc thực thi các lệnh tùy chỉnh ngay khi máy ảo khởi động là rất phổ biến. **Startup Script** được thiết kế nhằm đáp ứng chính xác yêu cầu này.

---

## 1. Khái niệm Startup Script của VM

**Startup Script** là một tập tin chứa các lệnh được **tự động thực thi mỗi khi máy ảo (VM) khởi động**.

Các đặc điểm chính:

* Hỗ trợ trên cả **VM Linux** và **VM Windows**.
* Có thể cấu hình ở **cấp độ VM** hoặc **cấp độ Project**.
* Startup Script ở **cấp độ VM sẽ ghi đè (override)** Startup Script ở cấp độ Project.

**Ví dụ ứng dụng:**
Khi cần áp dụng cùng một kịch bản (ví dụ: cài đặt phần mềm diệt virus, agent giám sát, logging agent) cho toàn bộ VM trong một dự án, Startup Script ở cấp Project là lựa chọn phù hợp.

---

## 2. Startup Script trên hệ điều hành Linux

### 2.1. Các loại Startup Script

* **Bash Script** (phổ biến nhất).
* **Script không phải Bash**: được hỗ trợ nếu chỉ định rõ trình thông dịch (interpreter).

**Ví dụ:**

```python
#! /usr/bin/python3
print("Hello from Python startup script")
```

### 2.2. Cơ chế hoạt động nội bộ
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fgf8htbzhokxnmzqzdu0k.png)

Khi bạn cung cấp Startup Script cho một VM:

* Google Compute Engine sao chép script vào máy ảo.
* Thiết lập quyền thực thi (execute permission) cho script.
* Script được chạy với **quyền root** trong quá trình VM khởi động.

---

## 3. Startup Script trong Google Compute Engine – Các điểm quan trọng

### 3.1. Số lượng Startup Script trên mỗi VM

* Một VM có thể được cấu hình **nhiều Startup Script** thông qua metadata.

### 3.2. Thứ tự thực thi

Startup Script được thực thi theo thứ tự dựa trên khóa metadata:

1. **Metadata key: `startup-script`**

   * Script được khai báo trực tiếp trong metadata hoặc trên máy cục bộ.
   * Được thực thi **trước**.

2. **Metadata key: `startup-script-url`**

   * Script được lưu trữ trong **Google Cloud Storage (GCS)**.
   * Được thực thi **sau**.

### 3.3. Giới hạn kích thước script

* Kích thước tối đa cho mỗi Startup Script là **256 KB**.

---

## 4. Lợi ích và mục đích sử dụng Startup Script

Startup Script được sử dụng nhằm:

* Tự động cài đặt phần mềm và dịch vụ (Apache, Nginx, cơ sở dữ liệu, v.v.).
* Cấu hình các agent giám sát, logging và bảo mật.
* Triển khai các chính sách ở cấp độ dự án mà không cần cấu hình thủ công từng VM.
* Rút ngắn thời gian triển khai hạ tầng bằng cách tự động hóa các tác vụ trong quá trình khởi động VM.

---

**Kết luận:**
Startup Script là một thành phần nền tảng trong quản trị Google Compute Engine, giúp chuẩn hóa cấu hình hệ thống, tăng tính nhất quán và hiệu quả vận hành. Việc nắm vững cơ chế và cách sử dụng Startup Script là kiến thức trọng tâm đối với chứng chỉ **Google Cloud Associate Cloud Engineer**.
