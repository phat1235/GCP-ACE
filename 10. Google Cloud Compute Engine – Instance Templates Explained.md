![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fog5usa94r6wi5ydtobfv.png)


## **Google Cloud Compute Engine – Giải thích về Instance Templates (GCP)**

---

### Tổng quan

Trong quá trình làm việc với **Google Cloud Compute Engine**, việc quản lý nhiều máy ảo (VM) có cấu hình giống nhau thường gây lặp lại và kém hiệu quả. **Instance Templates** được thiết kế để giải quyết vấn đề này bằng cách chuẩn hóa và tái sử dụng cấu hình VM.

---

### 1. Instance Template là gì?

**Instance Template** là một tài nguyên cấu hình có thể tái sử dụng trong Google Cloud, cho phép bạn nhanh chóng:

* Tạo các **VM Instances**
* Tạo **Managed Instance Groups (MIGs)** (sẽ được đề cập ở phần sau)
* Tạo **VM Reservations** (tức thời hoặc trong tương lai)

Instance Template lưu trữ toàn bộ các thông tin cấu hình của một VM, bao gồm:

* **Cấu hình máy**: loại máy, số vCPU, dung lượng bộ nhớ
* **Đĩa khởi động (Boot Disk)** hoặc **Container Image**
* **Identity & API Access**: Service Account, quyền truy cập API
* **Cấu hình Firewall**
* **Networking** và **Sole-Tenancy**
* **Quản lý, Bảo mật và Cấu hình đĩa** (Management, Security, Disk settings)
* **Metadata và Startup Script** (nếu có)

---

### 2. Lý do sử dụng Instance Templates

* Tạo các VM có **cấu hình hoàn toàn giống nhau**
* Định nghĩa cấu hình VM **một lần và tái sử dụng nhiều lần**
* Đảm bảo **tính nhất quán, khả năng lặp lại và tự động hóa** khi mở rộng hệ thống
* Là nền tảng quan trọng cho **autoscaling** và **quản lý hạ tầng theo mô hình Infrastructure as Code**

---

### 3. Cập nhật Instance Templates

⚠️ **Instance Template là bất biến (immutable)** – không thể chỉnh sửa sau khi đã tạo.

Cách cập nhật đúng:

* Sử dụng chức năng **Create Similar** để sao chép một template hiện có
* Thực hiện **bổ sung hoặc điều chỉnh cấu hình** trên template mới
* Sử dụng template mới cho các VM hoặc MIG tiếp theo

---

### 4. Ghi đè cấu hình (Overriding Configurations)

Khi tạo VM từ Instance Template, bạn **vẫn có thể ghi đè một số cấu hình nhất định**, ví dụ:

* Kích thước đĩa
* Metadata
* Một số tham số mạng hoặc nhãn (labels)

Lưu ý: Các thay đổi này **không làm thay đổi Instance Template gốc**.

---

### 5. Các cách tạo Instance Template

* **Tạo từ đầu (From scratch)**: cấu hình thủ công toàn bộ thông số
* **Tạo từ template có sẵn**: sử dụng **Create Similar**
* **Tạo từ VM hiện hữu**:

  * Chỉ thực hiện được thông qua **gcloud CLI hoặc API**
  * **Không hỗ trợ trực tiếp trên Google Cloud Console**

---

### 6. Instance Templates mang tính xác định (Deterministic)

**Khuyến nghị thực hành tốt (Best Practice):** luôn xây dựng Instance Template theo hướng **deterministic** (xác định rõ ràng).

Ví dụ:

* Trong startup script, chỉ rõ phiên bản phần mềm
  (ví dụ: `nginx=1.18.0` thay vì chỉ `nginx`)

Lợi ích:

* Tránh hành vi không mong muốn do thay đổi phiên bản phần mềm bên thứ ba
* Đảm bảo tính ổn định và khả năng tái tạo môi trường

---

### 7. Instance Template cấp Global, Regional và Zonal

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F2rvmnw64gkwxbv29hg3l.png)

Instance Template có thể được tạo ở các phạm vi sau:

* **Global**
* **Regional**

Tuy nhiên, cần lưu ý các ràng buộc sau:

* Nếu template sử dụng **tài nguyên cấp Zone** (ví dụ: zonal persistent disk), template sẽ **bị giới hạn trong zone đó**
* Nếu template Global sử dụng **tài nguyên cấp Region**, template sẽ **bị giới hạn trong region tương ứng**
* Phạm vi của template phụ thuộc trực tiếp vào **tài nguyên được tham chiếu bên trong**

---

### 8. Tổng kết (Key Takeaways)

* **Instance Templates** là **bản thiết kế (blueprint)** cho VM
* Rất hiệu quả cho **mở rộng hệ thống, tự động hóa và duy trì môi trường đồng nhất**
* Template **bất biến** → cập nhật bằng cách **Create Similar**
* Luôn sử dụng **cấu hình deterministic** để đảm bảo độ tin cậy
* Hỗ trợ phạm vi **Global, Regional và Zonal** tùy theo tài nguyên sử dụng
