![](https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Ft6uox77zj0p44lz7yfd2.png)
## **Google Compute Engine – Spot VMs và Preemptible Instances (Máy ảo tạm thời)**

---

### Tổng quan

Trong quá trình vận hành hệ thống trên nền tảng đám mây, **tối ưu chi phí** luôn là một mục tiêu quan trọng. **Google Compute Engine (GCE)** cung cấp **Spot VMs** (trước đây là **Preemptible VM Instances**), cho phép sử dụng tài nguyên tính toán với **mức chi phí thấp hơn khoảng 60%–91%** so với VM tiêu chuẩn.

Mức giá thấp này đi kèm với những đặc điểm và giới hạn nhất định, đòi hỏi người dùng phải thiết kế workload phù hợp.
![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fugabqz8mwle98y4tz227.png)
---

### 1. Spot VM Instances là gì?

**Spot VMs** là các máy ảo được tạo từ **năng lực tính toán dư thừa (excess capacity)** của Google Compute Engine.

Đặc điểm chính:

* Chi phí thấp, tối ưu ngân sách
* Có thể bị **Google thu hồi (preempt)** bất kỳ lúc nào khi tài nguyên cần được phân bổ cho các workload ưu tiên hơn
* Trước khi bị dừng hoặc xóa, VM sẽ nhận được **thông báo trước 30 giây** để lưu trạng thái hoặc xử lý công việc đang chạy

---

### 2. Vì sao Spot VMs có chi phí rẻ?

Spot VMs không được đảm bảo thời gian chạy liên tục:

* Có thể bị dừng hoặc xóa **bất kỳ thời điểm nào**
* Không đảm bảo duy trì tài nguyên dài hạn
* **Dữ liệu trong bộ nhớ (RAM) không được bảo toàn** khi VM bị dừng hoặc xóa

Khi Spot VM bị thu hồi, người dùng có thể cấu hình một trong hai hành vi:

* **Stop VM (mặc định)**: VM có thể được khởi động lại sau này, nhưng trạng thái bộ nhớ (RAM) không được giữ
* **Delete VM**: VM bị xóa vĩnh viễn

Chính sự không chắc chắn này là yếu tố cốt lõi giúp Spot VMs có **mức chiết khấu rất lớn (60%–91%)** so với VM thông thường.

---

### 3. Khả năng chịu lỗi là yếu tố then chốt

Để khai thác hiệu quả Spot VMs, workload cần được thiết kế theo hướng **chịu lỗi (fault-tolerant)**, tức là hệ thống vẫn tiếp tục hoạt động ngay cả khi một VM bị dừng hoặc mất hoàn toàn.

Các mô hình phù hợp:

* Ứng dụng **stateless**
* Batch jobs
* Hệ thống phân tán, nơi việc mất một node không ảnh hưởng nghiêm trọng đến toàn bộ hệ thống

---

### 4. Các hạn chế của Spot VMs

Trước khi lựa chọn Spot VMs, cần lưu ý các giới hạn sau:

* Có thể bị Google thu hồi **bất kỳ lúc nào**
* **Không hỗ trợ Live Migration**
* **Không hỗ trợ Automatic Restart** trong các sự kiện bảo trì
* **Không có SLA (Service Level Agreement)**
* **Không đảm bảo luôn có sẵn**, do phụ thuộc vào dung lượng dư thừa
* **Không được áp dụng trong Free Tier**

---

### 5. Các kịch bản sử dụng Spot VMs

Spot VMs phù hợp với các workload **nhạy cảm về chi phí** và **chấp nhận gián đoạn**.

#### 5.1. Workload truyền thống

* High Performance Computing (HPC)
* Big Data và Analytics
* CI/CD pipelines
* Batch Processing

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F8e2wi9n2hl7bp8o5xz18.png)

![](https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fb0vdomgk40qvykmy4m43.png)

#### 5.2. Workload container

* Sử dụng Spot VMs để tạo **node pool trong Google Kubernetes Engine (GKE)**
* Giúp giảm đáng kể chi phí cho các môi trường container hóa

---

### 6. Nhận định tổng quát

**Spot VMs** là một giải pháp tối ưu chi phí mạnh mẽ cho các workload có khả năng chịu gián đoạn. Chúng **không phù hợp với các ứng dụng trọng yếu** yêu cầu uptime cao và đảm bảo SLA, nhưng lại đặc biệt hiệu quả cho các bài toán phân tích dữ liệu, CI/CD, batch jobs và xử lý song song.

Việc kết hợp Spot VMs với **kiến trúc chịu lỗi** như auto-scaling, checkpointing, retry mechanism và phân tán workload là yếu tố quyết định để khai thác tối đa lợi ích của mô hình này.
